# 四、概要设计

## 4.1 前置设计

### 4.1.1 项目开发流程

项目开发采用 Gitflow 工作流，这种工作流非常适合版本控制和管理复杂的软件项目。其中，`main` 分支用于版本发布，`dev`
分支作为开发的主要分支，此外还有针对特定功能的 `feat` 分支和用于紧急修复的 `hot-fix` 分支。下面是这个工作流程的详细操作指南：

![gitflow-v1](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/gitflow-v1.svg)

- 初始化仓库
  1. 确保仓库中有 `main` 和 `dev` 分支，并且这两个分支受到保护，只能通过 Pull Request (PR) 合并，且需要管理员审核

- 新功能开发
  1. 当开发人员通过 issue 获得新的功能开发任务时，应从 `dev` 分支检出一个新的 `feat`
     分支，命名规则可以是 `feat/功能名称`
  2. 开发人员在 `feat` 分支上进行开发和本地测试
  4. 开发完成后，将 `feat` 分支推送到远程仓库，并创建一个 PR 到 `dev` 分支
  4. 通知测试人员对该功能分支进行测试
  5. 测试通过后，管理员审核 PR，合并 `feat` 分支到 `dev` 分支

- 版本发布
  1. 团队讨论确定合适的时机和版本号（tag）进行版本发布
  2. 创建一个 PR，将 `dev` 分支的更改合并到 `main` 分支
  4. 管理员审核 PR，并执行合并操作
  4. 在 `main` 分支上打上新的版本 tag，并推送 tag 到远程仓库
  5. github 的工作流在嗅探到 main 分支携带 tag 推送后就会进行自动化的版本构建

- 紧急修复

1. 当在生产环境中发现紧急 bug 时，从 `main` 分支检出一个 `hot-fix` 分支，命名规则可以是 `hot-fix/问题描述`。
2. 在 `hot-fix` 分支上进行修复工作。
4. 修复完成并测试通过后，将 `hot-fix` 分支推送到远程仓库，并创建一个 PR 到 `main` 分支。
4. 同时，为了保持 `dev` 分支的代码与 `main` 分支同步，还应该创建一个 PR 将 `hot-fix` 分支的更改合并回 `dev` 分支。
5. 管理员审核 PR，并执行合并操作。
6. 在 `main` 分支上打上一个新的版本 tag（如果适用），并推送 tag 到远程仓库。

- 注意事项
  1. **保持分支同步**：在 `feat` 分支开发期间，定期从 `dev` 分支拉取最新的更改，以避免未来合并时出现大量冲突。
  2. **代码审查**：利用 Pull Request 进行代码审查，确保代码质量和一致性。
  4. **定期清理**：合并后的分支应定期删除，以保持仓库的整洁。
  4. **文档和标签**：每次发布新版本时，更新项目文档，并确保 tag 符合版本命名规范，如使用语义化版本控制（SemVer）。

![image-20240512114226779](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/image-20240512114226779.png)

![image-20240512114327764](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/image-20240512114327764.png)

### 4.1.2 项目基础结构

| 模块       | 描述                                                         |
| ---------- | ------------------------------------------------------------ |
| **client** | 客户端模块，主要用于客户使用主要进行数据收集并上报给服务端   |
| **server** | 服务端模块，保存客户端信息，接收并处理客户端发来的监控数据，搭配 web 模块进行数据的可视化 |
| **web-ui** | 网页端，展示服务器数据，实时更新服务器运行状态配合后端完成前端伪 SSH 终端快捷方便对服务器进行管理 |
| **docs**   | 项目文档部分，面向用户和开发者，提供丰富的文档描述           |

### 4.1.3 人员与分工

| 角色                    | 职责                                                         |
| ----------------------- | ------------------------------------------------------------ |
| **曹宝琪  23093121 02** | 担任组长兼后端代码实现，负责项目整体结构的搭建，具体编程实现，组织协调成员 |
| **曹蓓    23093121 03** | 担任项目管理员兼UML 类图的绘制，负责项目 issue 组织分配、pull request 审核等相关工作 |
| **程柄惠** 23093121 05  | 担任开发员兼前端代码实现，负责前端项目结构的搭建，以及具体编程实现 |
| **焦慧静** 23093121 12  | 担任开发员兼数据库管理工作，负责数据库相关工作以及后期撰稿工作 |

### 4.1.4 沟通计划

组内定期开展线下或线上例会讨论项目，创建有项目协作群便用及时交流，项目实现主要通过 git 版本控制协作完成。

![image-20240523175411058](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/202405231754213.png)



### 4.1.5 风险管理与质量保证计划

- **质量目标**
  1. 系统可用性和测试覆盖率满足相关标准
  2. 系统可以按照预期完成规定的任务

- **质量控制措施**
  1. 代码审查：定期进行代码审查，确保代码质量和遵循最佳实践
  2. 单元测试：为所有新开发的功能和修复的缺陷编写单元测试，确保代码的稳定性
  4. 集成测试：在模块或功能集成到主分支之前，进行集成测试，确保各部分可以正常协同工作
  4. 性能测试：定期进行性能测试，确保系统响应时间和处理能力满足要求

- **测试计划**

  1. 定义详细的测试范围：明确哪些功能或模块将被测试通过相应的测试方法如单元测试、集成测试、系统测试、性能测试等在满足相关测试资源（包括所需的硬件、软件、测试工具和人员）的情况下进行测试

  1. 时间表：详细的测试阶段和每个阶段的预期时间

  1. 责任分配：明确哪个团队或个人负责哪些测试活动

## 4.2 功能设计

### 4.2.1 用户管理功能

| 功能       | 描述                                                         |
| ---------- | ------------------------------------------------------------ |
| 注册       | 用户通过提供邮箱地址、用户名和密码进行注册。系统对密码进行加密处理后存储，确保用户信息的安全。注册过程中，系统发送一封验证邮件到用户提供的邮箱地址，用户需按照相关信息进行邮箱验证，以激活账户。 |
| 登录       | 用户可以使用注册的用户名或邮箱和密码登录系统。登录时提供“记住我”选项，若用户勾选，系统将在本地存储加密的登录凭证，以实现用户再次访问时无需登录。 |
| 记住我     | 实现记住我功能，通过在客户端存储加密的用户身份标识，实现用户长时间内无需重复登录。出于安全考虑，记住我的有效期应设定为一定时间范围，例如30天。 |
| 退出       | 用户在完成操作后可以选择退出登录，系统将清除所有相关的会话信息和本地存储的登录凭证，确保账户安全。 |
| 修改密码   | 用户在登录状态下，可以通过提供旧密码和设置新密码的方式来修改密码。修改密码时，系统应进行实时的密码强度检测，引导用户设置安全性更高的密码。 |
| 找回密码   | 用户在忘记密码时，可以通过注册邮箱启动密码找回流程。系统通过发送包含密码重置链接的邮件到用户的注册邮箱，用户点击链接后跳转到密码重置页面，设置新密码后完成密码找回。 |
| 个人中心页 | 用户登录后，可以访问个人中心页，查看和编辑个人信息，如邮箱、用户名、头像等。个人中心页还应提供密码修改和账户注销等功能。 |

安全性考虑

- 所有用户信息的传输均应通过 SSL 加密，防止数据在传输过程中被截获
- 密码在服务器端存储前需进行哈希处理，且应使用盐值增加破解难度
- 对于“记住我”功能，存储在本地的凭证应进行加密处理，并定期更新加密策略，以防止长期使用同一加密方法可能带来的安全风险。

### 4.2.2 数据收集、上报、展示功能

| 功能         | 描述                                                         |
| ------------ | ------------------------------------------------------------ |
| 数据收集     | 系统部署轻量级监控代理于目标服务器，定期收集CPU使用率、内存使用量、磁盘读写速率、网络带宽等性能指标数据。 |
| 数据传输     | 通过TLS加密的安全通道发送数据，并在发送前进行压缩以减轻网络负载。 |
| 实时展示     | 将收集的数据以图表或仪表盘形式实时展示在用户界面，支持用户自定义监控仪表盘。 |
| 警报机制     | 用户可设置关键性能指标的阈值，超阈值时系统触发警报并通过邮件或短信通知管理员，同时支持警报历史记录查询和管理。 |
| 图表展示     | 系统根据监控数据生成多种图表，如CPU和内存使用率的时间序列图、磁盘和网络使用的饼图等，用户可自选数据指标和图表类型进行展示。 |
| 历史数据分析 | 系统存储并支持历史监控数据的查询和分析，用户可选择时间范围回顾服务器性能的历史变化。 |

安全性考虑

- 监控代理与服务器监控系统之间的通信需要加密，确保数据传输的安全性。
- 监控代理的部署和更新应通过安全的手段进行，防止恶意代码的植入。
- 确保存储和展示的数据不包含敏感信息，如密码、个人信息等。
- 对于访问历史数据的功能，应实施访问控制，确保只有授权用户才能访问。

### 4.2.3 远程管理功能

| 功能     | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| 命令执行 | 管理员通过监控系统界面输入命令或脚本，系统将命令发送至目标服务器上的监控代理执行，并返回执行结果。 |
| 任务调度 | 支持定时执行任务，管理员可设定特定时间执行特定命令或脚本，同时支持周期性任务调度，如每日、每周或每月执行。 |

安全性考虑

- 执行命令时，系统应限制可执行命令的范围，防止潜在的安全风险。
- 系统应记录所有执行的命令和结果，以供审计和故障排查。

## 4.3 非功能设计

### 4.3.1 安全性设计

- **数据加密**：所有通过网络传输的数据，包括用户认证信息、监控数据等，都应使用强加密协议（如TLS）进行加密，防止数据泄露或被篡改。
- **用户认证和授权**：系统应实现强认证机制，如两因素认证，确保只有授权用户才能访问系统。此外，应实现细粒度的访问控制，根据用户角色限制对特定功能和数据的访问。
- **日志和审计**：系统应记录详细的操作日志，包括用户登录、执行命令、修改配置等操作，以便于事后审计和问题排查。
- **定期安全审查**：系统应定期进行安全审查和漏洞扫描，及时发现并修复安全漏洞。

### 4.3.2 性能和可靠性设计

- **实时性**：监控数据的收集和展示应尽可能实时，确保管理员可以及时发现并响应问题。
- **高并发处理**：系统应能够处理高并发请求，保证在多用户同时使用时仍能保持良好的性能。
- **数据处理能力**：系统应具备高效的数据处理能力，能够快速处理和分析大量监控数据
- **高可用性**：系统应设计为高可用架构，通过技术如负载均衡、故障转移等确保系统的持续运行。
- **数据备份和恢复**：系统应定期备份关键数据，并能在数据丢失或损坏后快速恢复。
- **故障监测和自动恢复**：系统应能够自动监测到故障并尽可能自动恢复，减少人工干预

### 4.3.3 维护和拓展性设计

- **模块化设计**：系统应采用模块化设计，各个功能模块之间耦合度低，便于单独维护和升级。
- **文档和API**：提供完整的系统文档和API文档，方便开发者和管理员理解和使用系统。
- **拓展性**：系统设计应考虑未来拓展，如新增监控指标、集成第三方服务等，应能够方便地进行拓展

### 4.2.4 文档设计

- **用户手册**：提供给最终用户，介绍系统的功能、操作流程和使用方法，帮助用户快速上手和有效使用系统。
- **安装指南**：详细说明系统的安装步骤和配置要求，确保系统能够正确部署和运行。
- **管理员指南**：为系统管理员提供高级配置、维护和故障排除的指导，确保系统能够稳定运行并及时处理问题。
- **开发文档**：包括API文档、技术架构说明和代码注释等，为开发人员提供必要的信息，以便于系统的二次开发和集成。

## 4.4 项目交付与后期支持

### 4.4.1 项目交付

| **ArtifactId**                   | **内容**                               |
| -------------------------------- | -------------------------------------- |
| `monitor-server.jar :version`    | 服务端 jar 包                          |
| `path-install:docker-compose`    | 服务端环境安装文件 docker compose.yaml |
| `cbq2024/monitor-client:version` | 客户端 Docker Image                    |
| `cbq2024/monitor-web-ui:version` | 网页端 Docker Image                    |
| `docs`                           | 项目文档                               |

### 4.4.2 后期支持

项目交付后，我们将提供一系列的后期支持服务，确保系统的稳定运行和持续优化。以下是后期支持的主要内容：

1. **技术支持**：提供技术咨询服务，解答用户在使用过程中遇到的技术问题。
2. **系统维护**：定期检查系统运行状态，进行必要的维护和更新，确保系统安全稳定。
3. **故障响应**：设立专门的故障响应团队，对系统出现的故障进行快速定位和修复。
4. **功能升级**：根据用户反馈和技术发展，定期推出新功能或优化现有功能。
5. **培训服务**：为用户提供系统操作和维护的培训，帮助用户更好地使用和管理系统。
6. **文档更新**：定期更新项目文档，确保用户能够获取最新的操作指南和系统信息。

通过这些后期支持措施，我们旨在为用户提供一个可靠、高效且易于维护的系统环境。

## 4.5 开发周期与里程碑

1. **项目阶段划分**

项目采用` V 主版本.次版本.修复版` 的格式进行编排，约定每周二举行线下例会时，完成相关版本的发布，然后讨论遇到的问题并商讨下个版本的开发流程。

2. **关键里程碑**

| 版本   | 开发周期      | 描述                                               |
| ------ | ------------- | -------------------------------------------------- |
| v0.1.0 | `4.30 - 4.8 ` | 完成项目整体结构搭建                               |
| v1.1.0 | `4.9 - 4.16`  | server + web 端实现登录-注册相关功能               |
| v1.2.0 | `4.16 - 4.23` | 为项目添加友好的项目文档，添加 workflow 工作流构建 |

![image-20240512114034887](https://2024-cbq-1311841992.cos.ap-beijing.myqcloud.com/picgo/image-20240512114034887.png)
